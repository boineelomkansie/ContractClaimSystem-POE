@model ContractClaims.Models.Claim
@{
    ViewData["Title"] = "Submit Claim";
    var contracts = ViewBag.Contracts as List<ContractClaims.Models.Contract> ?? new();
    var lecturers = ViewBag.Lecturers as List<ContractClaims.Models.Lecturer> ?? new();
}
<h2>Submit Claim</h2>

<form asp-action="Submit" method="post" enctype="multipart/form-data" class="form">
    <label>Lecturer</label>
    <select name="LecturerId" required>
        <option value="">-- select --</option>
        @foreach (var l in lecturers)
        {
            <option value="@l.Id">@l.FullName (@l.EmployeeNumber)</option>
        }
    </select>

    <label>Contract</label>
    <select name="ContractId" required>
        <option value="">-- select --</option>
        @foreach (var c in contracts)
        {
            <option value="@c.Id">@c.ContractCode - @c.Description</option>
        }
    </select>

    <label>Month (YYYY-MM)</label>
    <input name="Month" placeholder="2025-11" pattern="\d{4}-\d{2}" required />

    <label>Hours worked</label>
    <input name="Hours" type="number" step="0.1" min="0" required />

    <label>Hourly rate (ZAR)</label>
    <input name="HourlyRate" type="number" step="0.01" min="0" required />

    <label>Comments</label>
    <textarea name="Comments"></textarea>

    <label>Upload supporting document (.pdf, .docx, .xlsx) - max 5MB</label>
    <input type="file" name="upload" accept=".pdf,.docx,.xlsx" />

    <div>
        <label>Calculated Total (ZAR)</label>
        <div id="calculatedTotal" style="font-weight:bold">0.00</div>
    </div>

    <div class="form-actions">
        <button class="btn" type="submit">Submit Claim</button>
        <a class="btn secondary" href="/">Cancel</a>
    </div>
</form>

<script>
    (function(){
        const hoursEl = document.querySelector('input[name="Hours"]');
        const rateEl = document.querySelector('input[name="HourlyRate"]');
        const totalEl = document.getElementById('calculatedTotal');

        function updateTotal(){
            const hours = parseFloat(hoursEl.value) || 0;
            const rate = parseFloat(rateEl.value) || 0;
            const total = (hours * rate).toFixed(2);
            totalEl.textContent = total;
        }

        hoursEl.addEventListener('input', updateTotal);
        rateEl.addEventListener('input', updateTotal);

        document.querySelector('form').addEventListener('submit', function(e){
            const fileInput = document.querySelector('input[type=file]');
            if(fileInput && fileInput.files.length>0){
                const f = fileInput.files[0];
                if(f.size > 5 * 1024 * 1024){
                    e.preventDefault();
                    alert('File too large. Maximum allowed size is 5 MB.');
                    return false;
                }
                const allowed = ['application/pdf','application/vnd.openxmlformats-officedocument.wordprocessingml.document','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'];
                // some browsers may not report mime types reliably; extension check is also server-side
            }
        });
    })();
</script>
